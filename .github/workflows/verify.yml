name: Verify Code

on:
  push:
    branches: ["*"]
    paths-ignore:
      - "**/*.md"

  pull_request:
    branches: ["*"]
    paths-ignore:
      - "**/*.md"

jobs:
  type-check:
    name: TypeScript Type Checking
    runs-on: ubuntu-latest
    strategy:
      matrix:
        node-version: [22.x]
    steps:
      - uses: actions/checkout@v4
      - uses: ./.github/actions/setup-pnpm
      - name: Type check
        run: pnpm check

  lint:
    name: Linter Checks
    runs-on: ubuntu-latest
    strategy:
      matrix:
        node-version: [22.x]
    steps:
      - uses: actions/checkout@v4
      - uses: ./.github/actions/setup-pnpm
      - name: Lint
        run: pnpm lint

  format:
    name: Formatter Checks
    runs-on: ubuntu-latest
    strategy:
      matrix:
        node-version: [22.x]
    steps:
      - uses: actions/checkout@v4
      - uses: ./.github/actions/setup-pnpm
      - name: Check formatting
        run: pnpm format:check

  build-plugin:
    name: Build Verification
    runs-on: ubuntu-latest
    strategy:
      matrix:
        node-version: [22.x]
    needs: [type-check, lint, format]
    steps:
      - uses: actions/checkout@v4
      - uses: ./.github/actions/setup-pnpm
      - name: Build plugin
        run: pnpm build
      - name: Verify build artifacts
        run: |
          echo "üîç Verifying build artifacts..."
          if [ -d "dist" ]; then
            echo "‚úÖ Plugin build artifacts found"
          else
            echo "‚ùå Plugin build artifacts missing"
            exit 1
          fi
